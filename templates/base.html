<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>A Python SAML Toolkit by OneLogin demo</title>

    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">
      <h1>A Python SAML Toolkit by OneLogin demo</h1>

      {% block content %}{% endblock %}
    </div>
  </body>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script src="https://code.jquery.com/jquery-3.5.1.min.js" ></script>
  <script>
    window.onload = function () {
      google.accounts.id.initialize({
        client_id: '{{one_tap_client_id}}',
        login_url: 'http://localhost:8000/login',
        callback: function (credentialResponse) {
          let response = credentialResponse;
          $.ajax({
            type: 'POST',
            url: '/one-tap-login',
            headers: {
              'X-Requested-With': 'XMLHttpRequest'
            },
            contentType: 'application/JSON; charset=utf-8',
            success: function(result) {
              if (!result) {
                return ;
              }
              
              if (result.accessToken) {
                localStorage.setItem("accessToken", result.accessToken);
                localStorage.setItem("refreshToken", result.refreshToken);
              }
              location.reload();
            },
            processData: false,
            data: JSON.stringify({credential: response.credential})
          });
        }
      });
      google.accounts.id.prompt();
    };
  </script>
</html>
